<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<title>Abacus 2K18</title>
	<link rel="icon" href="/images/home.jpg">
	<link rel="stylesheet" href="/css/bootstrap.css">
	<script src="/jquery.js"></script>
	<script src="/js/bootstrap.js"></script>
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
</head>
<body class="bg-light">
	<div class="loading">
		<div class="alert alert-primary">Loading...</div>
	</div>
	<div class="body" style="display: none;">
		<div class="jumbotron jumbotron-fluid bg-dark text-white">
			<div class="container">
				<h1 class="display-4">Abacus 2K18</h1>
				<p class="lead"><%- data.section %> Section</p>
			</div>
		</div>
		<div class="container-fluid">
			<div class="alert text-center" style="display: none;" id="alert">
				<span class="message"></span>
				<button class="close" onclick="$('#alert').hide('slow')">
					<span>&times;</span>
				</button>
			</div>
			<div class="events-tab">
				<div class="form-group d-flex justify-content-center">
					<button class="btn btn-outline-primary" onclick="editEvent();">New</button>
				</div>
				<div class="list-group" id="events"></div>
				<div align="center"><br><a class="btn btn-outline-primary" href="logout">Logout</a></div>
			</div>
			<div class="edit-event" style="display: none;">
				<div class="container-fluid row form-group">
					<button class="btn btn-outline-primary" onclick="back();">Back</button>
				</div>
				<form id="form" action="<%- data.section_code %>/save" method="POST" enctype="multipart/form-data" autocomplete="off">
					<input type="hidden" id="_id">
					<div class="input-group form-group">
						<div class="input-group-prepend">
							<label for="name" class="input-group-text">Name</label>
						</div>
						<input type="text" class="form-control" id="name">
					</div>
					<div class="input-group form-group">
						<div class="input-group-prepend">
							<label for="description" class="input-group-text">Description</label>
						</div>
						<textarea class="form-control" id="description"></textarea>
					</div>
					<div class="input-group form-group">
						<div class="input-group-prepend">
							<label class="input-group-text" for="time">Time</label>
						</div>
						<input type="time" class="form-control" id="time">
					</div>
					<div class="input-group form-group">
						<div class="input-group-prepend">
							<label class="input-group-text" for="venue">Venue</label>
						</div>
						<input type="text" class="form-control" id="venue">
					</div>
					<%- include(data.include) %>
					<div class="form-group">
						<input type="submit" value="Save" class="btn btn-outline-primary form-control">
					</div>
				</form>
			</div>
		</div>
	</div>
</body>
<script type="text/javascript">
	$(document).ready(()=>{
		$('.loading').hide();
		$('.body').fadeIn(1000);
	});
	back=()=>{
		$('.edit-event').hide();
		$('.events-tab').fadeIn(1000);
	}
	events=[];
	addEvents=()=>{
		console.log(events);
		$("#events").html("");
		events.forEach((event,ind)=>{
			$("#events").append(`
				<div class="list-group-item">
				<a href="#${event.name}" onclick=editEvent(${ind});>${event.name}</a>
				<button class="close text-danger" style="float:right;" onclick=remEvent('${event._id}');>&times;</button>
				</div>
				`);
		});
	}
	(getEvents=()=>{
		$.ajax({
			method:'POST',
			url:'<%- data.section_code %>/events',
		}).done((res)=>{
			events=res.events;
			addEvents();
		});
	})();
	remEvent=(_id)=>{
		if(!confirm('Are you sure to Delete?')){
			return;
		}
		$.ajax({
			url:'<%- data.section_code %>/remove',
			type:'POST',
			data:{_id:_id},
		}).done((res)=>{
			if(res.code==0){
				location.replace="/admin";
			}
			else if(res.code==1){
				getEvents();
				$('.alert .message').html(res.message);
				$('.alert').addClass('alert-success').show('slow');
			}
		})
	}
	close=()=>{
		console.log('ehre')
		$('#alert').hide('slow');
	}
</script>
</html>